(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{347:function(t,e,s){"use strict";s.r(e);var a=s(4),r=Object(a.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h3",{attrs:{id:"vue-router-源码浅析"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#vue-router-源码浅析"}},[t._v("#")]),t._v(" vue router 源码浅析")]),t._v(" "),e("h4",{attrs:{id:"概述"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[t._v("#")]),t._v(" 概述")]),t._v(" "),e("h4",{attrs:{id:"常用属性介绍"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#常用属性介绍"}},[t._v("#")]),t._v(" 常用属性介绍")]),t._v(" "),e("h5",{attrs:{id:"routerlink"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#routerlink"}},[t._v("#")]),t._v(" "),e("code",[t._v("RouterLink")])]),t._v(" "),e("p",[e("code",[t._v("RouterLink")]),t._v("实际上就是通过 vue 的"),e("code",[t._v("defineComponent")]),t._v("方法定义的组件，创建一个"),e("code",[t._v("<a>")]),t._v("标签, 该组件内部会调用"),e("code",[t._v("useLink()")]),t._v("方法,这个"),e("code",[t._v("useLink")]),t._v("会根据参数 props 创建响应式的链接属性，以及处理链接事件")]),t._v(" "),e("h5",{attrs:{id:"routerview"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#routerview"}},[t._v("#")]),t._v(" "),e("code",[t._v("RouterView")])]),t._v(" "),e("p",[e("code",[t._v("RouterView")]),t._v("同上，也是 vue 的"),e("code",[t._v("defineComponent")]),t._v("定义的组件")]),t._v(" "),e("h4",{attrs:{id:"常用-api-介绍"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#常用-api-介绍"}},[t._v("#")]),t._v(" 常用 API 介绍")]),t._v(" "),e("h5",{attrs:{id:"createrouter"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#createrouter"}},[t._v("#")]),t._v(" "),e("code",[t._v("createRouter")])]),t._v(" "),e("p",[e("code",[t._v("createRouter")]),t._v(" 方法用来创建一个路由实例，该方法接收一个参数，该参数是一个对象，该对象用来配置路由实例,通常如下创建")]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" router "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("createRouter")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("history")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("createWebHashHistory")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  routes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br")])]),e("p",[e("code",[t._v("createRouter")]),t._v("方法创建的实例有以下属性")]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  currentRoute"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("listening")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  addRoute"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  removeRoute"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  hasRoute"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  getRoutes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  resolve"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  options"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  push"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  replace"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("go")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("step")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" routerHistory"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("go")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("step"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("back")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("go")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("forward")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("go")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("beforeEach")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" beforeGuards"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("beforeResolve")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" beforeResolveGuards"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("afterEach")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" afterGuards"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("onError")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" errorListeners"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  isReady"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  install"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br"),e("span",{staticClass:"line-number"},[t._v("15")]),e("br"),e("span",{staticClass:"line-number"},[t._v("16")]),e("br"),e("span",{staticClass:"line-number"},[t._v("17")]),e("br"),e("span",{staticClass:"line-number"},[t._v("18")]),e("br"),e("span",{staticClass:"line-number"},[t._v("19")]),e("br"),e("span",{staticClass:"line-number"},[t._v("20")]),e("br"),e("span",{staticClass:"line-number"},[t._v("21")]),e("br")])]),e("p",[e("code",[t._v("go")]),t._v("、"),e("code",[t._v("back")]),t._v("、"),e("code",[t._v("forward")]),t._v("方法本质上调用的都是 "),e("code",[t._v("options.history.go")]),t._v(" 方法,而这个"),e("code",[t._v("go")]),t._v("方法本质上还是"),e("code",[t._v("window.history.go")])]),t._v(" "),e("p",[e("code",[t._v("createRouter")]),t._v("首先就会调用"),e("code",[t._v("createRouterMatch")]),t._v("方法")]),t._v(" "),e("h6",{attrs:{id:"createroutermatch"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#createroutermatch"}},[t._v("#")]),t._v(" "),e("code",[t._v("createRouterMatch")])]),t._v(" "),e("p",[e("code",[t._v("createRouterMatch")]),t._v("方法接收一个"),e("code",[t._v("routes")]),t._v("数组和全局配置，会返回"),e("code",[t._v("addRoute")]),t._v("、"),e("code",[t._v("removeRoute")]),t._v("、"),e("code",[t._v("getRoutes")]),t._v("、"),e("code",[t._v("getRecordMatcher")]),t._v("、"),e("code",[t._v("resove")]),t._v("等方法。在其内部会遍历"),e("code",[t._v("routes")]),t._v("并调用"),e("code",[t._v("addRoute")])]),t._v(" "),e("blockquote",[e("p",[e("code",[t._v("addRoute")]),t._v(": 添加路由")])]),t._v(" "),e("h5",{attrs:{id:"createwebhistory"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#createwebhistory"}},[t._v("#")]),t._v(" "),e("code",[t._v("createWebHistory")])]),t._v(" "),e("p",[e("code",[t._v("createWebHistory")]),t._v("创建一个 history 模式路由, 返回一个 routerHistory 对象。该对象提供了以下方法："),e("code",[t._v("go")]),t._v("、"),e("code",[t._v("replace")]),t._v("、"),e("code",[t._v("push")]),t._v("、"),e("code",[t._v("listen")]),t._v("、"),e("code",[t._v("destory")]),t._v("、"),e("code",[t._v("pauselisten")]),t._v("等方法以及"),e("code",[t._v("location")]),t._v("和"),e("code",[t._v("state")]),t._v("对象。")]),t._v(" "),e("p",[e("code",[t._v("createWebHistory")]),t._v("方法中主要用到了"),e("code",[t._v("useHistoryStatenavigation")]),t._v("和"),e("code",[t._v("useHistoryListeners")]),t._v("方法.")]),t._v(" "),e("blockquote",[e("p",[t._v("实现步骤： 1.接收一个参数"),e("code",[t._v("base")]),t._v(",调用"),e("code",[t._v("normalizeBase")]),t._v("方法进行路由规范化处理，去除协议和域名部分，确保路由以"),e("code",[t._v("/")]),t._v("开头和不以"),e("code",[t._v("/")]),t._v("结尾 2.调用"),e("code",[t._v("useHistoryStatenavigation")]),t._v("方法，创建一个"),e("code",[t._v("navigation")]),t._v("对象，用于记录路由变化和状态 3.调用"),e("code",[t._v("useHistoryListeners")]),t._v("方法，创建一个"),e("code",[t._v("listeners")]),t._v("对象，用于记录路由变化监听器 4.赋值 2、3 的返回给"),e("code",[t._v("routerHistory")]),t._v("，并返回")])]),t._v(" "),e("h6",{attrs:{id:"usehistorystatenavigation"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#usehistorystatenavigation"}},[t._v("#")]),t._v(" "),e("code",[t._v("useHistoryStateNavigation")])]),t._v(" "),e("p",[e("code",[t._v("useHistoryStateNavigation")]),t._v("方法首先会根据"),e("code",[t._v("window.location")]),t._v("和 base 获取当前的路由值, 然后判断"),e("code",[t._v("window.history.state")]),t._v(",如果其不为空则调用"),e("code",[t._v("changeLocation")]),t._v("在其内部调用"),e("code",[t._v("window.history.replaceState")]),t._v("或者"),e("code",[t._v("window.history.pushState")]),t._v(",最后改变 state 的值。")]),t._v(" "),e("p",[e("code",[t._v("useHistoryStateNavigation")]),t._v("方法返回的"),e("code",[t._v("push")]),t._v("和"),e("code",[t._v("replace")]),t._v("方法均会调用"),e("code",[t._v("changeLocation")]),t._v("方法，其中"),e("code",[t._v("push")]),t._v("会调用两次")]),t._v(" "),e("h6",{attrs:{id:"usehistorylisteners"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#usehistorylisteners"}},[t._v("#")]),t._v(" "),e("code",[t._v("useHistoryListeners")])]),t._v(" "),e("p",[e("code",[t._v("useHistoryListeners")]),t._v("方法接收四个参数"),e("code",[t._v("base")]),t._v("、调用"),e("code",[t._v("useHistoryStateNavigation")]),t._v("方法返回的"),e("code",[t._v("state")]),t._v("、"),e("code",[t._v("location")]),t._v("属性和"),e("code",[t._v("replace")]),t._v("方法\n其内部实现主要逻辑是监听"),e("code",[t._v("popstate")]),t._v("和"),e("code",[t._v("beforeunload")]),t._v("事件，执行相应的路由切换逻辑，从而实现前端路由的控制和管理")]),t._v(" "),e("blockquote",[e("p",[e("code",[t._v("popstate")]),t._v("事件：浏览器的历史记录发生变化（用户的执行某些导航操作，如点击浏览器的前进、后退按钮或者通过 javascript 调用"),e("code",[t._v("history.pushState")]),t._v("、"),e("code",[t._v("history.replaceState")]),t._v("、"),e("code",[t._v("history.back()")]),t._v("和"),e("code",[t._v("history.forward()")]),t._v("等方法时会触发，触发"),e("code",[t._v("popstate")]),t._v("事件，"),e("code",[t._v("vue router")]),t._v("内部会执行"),e("code",[t._v("popStateHandler")]),t._v("函数，"),e("code",[t._v("popStateHandler")]),t._v("函数主要是判断"),e("code",[t._v("state")]),t._v(",如果"),e("code",[t._v("state")]),t._v("存在，则更新当前位置、历史状态并计算位置偏移值；如果"),e("code",[t._v("state")]),t._v("不存在，则调用"),e("code",[t._v("replace")]),t._v("方法更新。最后遍历了注册的所有监听器"),e("code",[t._v("listeners")]),t._v("并执行监听器, 传参为三个："),e("code",[t._v("currentLocation.value")]),t._v("：当前位置信息、"),e("code",[t._v("from")]),t._v(":之前的位置信息、路由变化的对象："),e("code",[t._v("delta")]),t._v("、"),e("code",[t._v("type")]),t._v(":'pop'、"),e("code",[t._v("direction")]),t._v("：正负表示前进、后退还是未知方向")])]),t._v(" "),e("blockquote",[e("p",[e("code",[t._v("beforeunload")]),t._v("事件：用于在用户即将离开当前页面（关闭页面、刷新页面、导航到其他页面）时触发，触发该事件时，"),e("code",[t._v("vue router")]),t._v("会执行"),e("code",[t._v("beforeUnloadListener")]),t._v("函数，调用"),e("code",[t._v("history.replaceState")]),t._v("方法")])]),t._v(" "),e("p",[t._v("以上两个监听的事件会在"),e("code",[t._v("destory")]),t._v("函数中移除")]),t._v(" "),e("h5",{attrs:{id:"createwebhashhistory"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#createwebhashhistory"}},[t._v("#")]),t._v(" "),e("code",[t._v("createWebHashHistory")])]),t._v(" "),e("p",[e("code",[t._v("createWebHashHistory")]),t._v(" 会创建一个 hash 模式的路由，同"),e("code",[t._v("createWebHistory")]),t._v("一样，接收一个参数"),e("code",[t._v("base")]),t._v("，会自动给 base 加上"),e("code",[t._v("#")]),t._v("，再调用"),e("code",[t._v("createWebHistory")]),t._v("并返回")]),t._v(" "),e("h5",{attrs:{id:"creatememoryhistory"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#creatememoryhistory"}},[t._v("#")]),t._v(" "),e("code",[t._v("createMemoryHistory")])]),t._v(" "),e("p",[e("code",[t._v("createMemoryHistory")]),t._v(" 会基于内存创建一个 history，主要用于处理服务端渲染 SSR，即不依赖于浏览器的实际 url 地址变化，而是在内存中维护路由历史记录。")]),t._v(" "),e("p",[e("code",[t._v("createMemoryHistory")]),t._v(" 返回的是一个"),e("code",[t._v("routerHistory")]),t._v("对象,这个对象包含"),e("code",[t._v("replace")]),t._v("、"),e("code",[t._v("push")]),t._v("、"),e("code",[t._v("listen")]),t._v("、"),e("code",[t._v("destroy")]),t._v("、"),e("code",[t._v("go")]),t._v("方法。"),e("code",[t._v("createMemoryHistory")]),t._v("内部维护了两个数组"),e("code",[t._v("listeners")]),t._v("、"),e("code",[t._v("quue")]),t._v("，"),e("code",[t._v("listeners")]),t._v("用于记录"),e("code",[t._v("listen")]),t._v("方法注册的回调函数，"),e("code",[t._v("queue")]),t._v("用于记录路由历史记录，可以被当作一个路由队列。")])])}),[],!1,null,null,null);e.default=r.exports}}]);