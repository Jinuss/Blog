---
title: Feature特征
date: 2025-01-04 09:23:49
permalink: /pages/3677be/
categories:
  - 《Openlayers源码》笔记
  - Render渲染篇
tags:
  -
author:
  name: 东流
  link: https://github.com/Jinuss
---

## 概述

## 源码分析

### `Feature`类的源码

`Feature`类的源码实现如下：

```js
class Feature extends BaseObject {
  constructor(geometryOrProperties) {
    super();
    this.on;
    this.once;
    this.un;
    this.id_ = undefined;
    this.geometryName_ = "geometry";
    this.style_ = null;
    this.styleFunction_ = undefined;
    this.geometryChangeKey_ = null;
    this.addChangeListener(this.geometryName_, this.handleGeometryChanged_);
    if (geometryOrProperties) {
      if (typeof getSimplifiedGeometry === "function") {
        const geometry = geometryOrProperties;
        this.setGeometry(geometry);
      } else {
        const properties = geometryOrProperties;
        this.setProperties(properties);
      }
    }
  }

  clone() {
    const clone = new Feature(
      this.hasProperties() ? this.getProperties() : null
    );
    clone.setGeometryName(this.getGeometryName());
    const geometry = this.getGeometry();
    if (geometry) {
      clone.setGeometry(geometry.clone());
    }
    const style = this.getStyle();
    if (style) {
      clone.setStyle(style);
    }
    return clone;
  }

  getGeometry() {
    return this.get(this.geometryName_);
  }

  getId() {
    return this.id_;
  }

  getGeometryName() {
    return this.geometryName_;
  }

  getStyle() {
    return this.style_;
  }

  getStyleFunction() {
    return this.styleFunction_;
  }

  handleGeometryChange_() {
    this.changed();
  }

  handleGeometryChanged_() {
    if (this.geometryChangeKey_) {
      unlistenByKey(this.geometryChangeKey_);
      this.geometryChangeKey_ = null;
    }
    const geometry = this.getGeometry();
    if (geometry) {
      this.geometryChangeKey_ = listen(
        geometry,
        EventType.CHANGE,
        this.handleGeometryChange_,
        this
      );
    }
    this.changed();
  }

  setGeometry(geometry) {
    this.set(this.geometryName_, geometry);
  }

  setStyle(style) {
    this.style_ = style;
    this.styleFunction_ = !style ? undefined : createStyleFunction(style);
    this.changed();
  }

  setId(id) {
    this.id_ = id;
    this.changed();
  }

  setGeometryName(name) {
    this.removeChangeListener(this.geometryName_, this.handleGeometryChanged_);
    this.geometryName_ = name;
    this.addChangeListener(this.geometryName_, this.handleGeometryChanged_);
    this.handleGeometryChanged_();
  }
}
```

## 总结
